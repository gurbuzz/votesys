{% extends "layout.html" %}
{% block content %}
<div class="card shadow-sm mx-auto" style="max-width:800px;">
  <div class="card-header bg-primary text-white">
    <h5 class="mb-0">Admin Paneli • Anketler</h5>
  </div>
  <div class="card-body">
    <table class="table">
      <thead>
        <tr><th>ID</th><th>Soru</th><th>Owner</th><th>İşlemler</th></tr>
      </thead>
      <tbody id="admin-table"></tbody>
    </table>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener("DOMContentLoaded", async () => {
  renderNavbar();
  const tbody = document.getElementById("admin-table");
  try {
    const ids = await fetch("/api/polls").then(r => r.json());
    for (let id of ids) {
      const poll = await fetch(`/api/polls/${id}`).then(r => r.json());
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${poll.id}</td>
        <td>${poll.question}</td>
        <td>${poll.owner}</td>
        <td>
          <button class="btn btn-sm btn-danger del-btn" data-id="${poll.id}">
            Sil
          </button>
        </td>`;
      tbody.appendChild(tr);
    }
    document.querySelectorAll(".del-btn").forEach(btn => {
      btn.onclick = async () => {
        if (!confirm("Silinsin mi?")) return;
        await fetchAuth(`/api/polls/${btn.dataset.id}`, { method: "DELETE" });
        location.reload();
      };
    });
  } catch {
    tbody.innerHTML = `<tr><td colspan="4" class="text-danger">Yüklenemedi</td></tr>`;
  }
});
</script>
{% endblock %}
