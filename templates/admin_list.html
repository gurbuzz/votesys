{% extends "layout.html" %}
{% block content %}
<div class="card shadow-sm mb-4">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h5 class="mb-0">Yönetici Paneli</h5>
    <a href="/admin/create" class="btn btn-sm btn-primary">➕ Yeni Anket</a>
  </div>
  <ul id="admin-poll-list" class="list-group list-group-flush">
    <!-- JS ile doldurulacak -->
  </ul>
  <div class="card-body text-center">
    <small class="text-muted">Anket yoksa yukarıda görünür</small>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  // giriş yapmamışsa login’e at
  const token = localStorage.getItem("token");
  if (!token) location.href = "/login";

  document.addEventListener("DOMContentLoaded", () => {
    fetch("/api/polls", {
      headers: { "Authorization": "Bearer " + token }
    })
    .then(r => r.json())
    .then(ids => {
      const ul = document.getElementById("admin-poll-list");
      if (!ids.length) {
        ul.innerHTML = '<li class="list-group-item text-center">Henüz anket yok.</li>';
        return;
      }
      ids.forEach(id => {
        ul.innerHTML += `
          <li class="list-group-item d-flex justify-content-between align-items-center">
            Anket #${id}
            <a class="btn btn-sm btn-outline-secondary" href="/poll.html?id=${id}">Görüntüle</a>
          </li>`;
      });
    })
    .catch(err => console.error(err));
  });
</script>
{% endblock %}
