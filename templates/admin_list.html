<!-- templates/admin_list.html -->
{% extends "layout.html" %}

{% block content %}
<div class="card shadow-sm mx-auto" style="max-width:700px;">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h5 class="mb-0">üõ† Y√∂netici Paneli</h5>
    <a href="/admin/create" class="btn btn-sm btn-primary">‚ûï Yeni Anket</a>
  </div>
  <ul id="admin-poll-list" class="list-group list-group-flush">
    <!-- JS ile eklenecek -->
  </ul>
  <div class="card-body text-center">
    <small class="text-muted">Hen√ºz anket yoksa yukarƒ±da g√∂r√ºn√ºr</small>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  (async function(){
    const token = localStorage.getItem("token");
    if (!token) return void(location.href = "/login");
    const ul = document.getElementById("admin-poll-list");
    ul.innerHTML = '';

    try {
      const ids = await fetch("/api/polls", {
        headers: { "Authorization": "Bearer " + token }
      }).then(r => r.json());

      if (!ids.length) {
        ul.innerHTML = '<li class="list-group-item text-center">Hen√ºz anket yok.</li>';
        return;
      }

      for (let id of ids) {
        const poll = await fetch(`/api/polls/${id}`, {
          headers: { "Authorization": "Bearer " + token }
        }).then(r => r.json());

        const opts = poll.options.map(o => o.text).join(", ");
        const li = document.createElement("li");
        li.className = "list-group-item position-relative";
        li.innerHTML = `
          <div><strong>#${poll.id}:</strong> ${poll.question}</div>
          <div class="text-muted small">≈ûƒ±klar: ${opts}</div>
          <a href="/poll.html?id=${poll.id}" class="btn btn-sm btn-outline-secondary position-absolute end-3 top-50 translate-middle-y">
            G√∂r√ºnt√ºle
          </a>`;
        ul.appendChild(li);
      }
    } catch (e) {
      console.error(e);
      ul.innerHTML = `<li class="list-group-item text-danger">Hata: ${e.message}</li>`;
    }
  })();
</script>
{% endblock %}
